<!DOCTYPE html> 
<html lang="en">

<head>
    <title>StraightFace - Home</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/styles.css">
    <link rel="shortcut icon" href="#">
    <link rel="icon" href="static/images/straightFaceLogoOfficial.svg" type="image/x-icon">
    <link rel="shortcut icon" href="static/images/straightFaceLogoOfficial.svg" type="image/x-icon">
    <script defer src="https://kit.fontawesome.com/e27ccd9755.js" crossorigin="anonymous"></script>
    <link defer href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet">
</head>

<body>  

    <header>
        <div class="header_logo">
            <img id="logo" src="static/images/straightFaceLogoOfficial.svg" alt="StraightFaceLogo" width="90" height="90">
            <a href="/" id="logo_name">StraightFace</a>
        </div>
        <div class="account_btn_container">
            <h2 style="color: white">{{ username }}</h2>
            <a href="/logout" class="account_btn" id="log_out_btn">Log Out</a>
            <div class="dropdown">
                <button id="dropDownBtn" onclick="dropDownMenu()"><i class="fa-solid fa-bars fa-2xl" style="color: #ffffff;"></i></button>
                <div id="dropDownMenu" class="dropdown-content">
                    <a href="/" class="dropdown_btn">Home</a>
                    <a href="/account" class="dropdown_btn">Account</a>
                </div>
            </div>
        </div>
    </header>

    <main>

        <div class="queue_container">
            <img id="container_logo" src="static/images/straightFaceLogoOfficial.svg" alt="StraightFaceLogo" width="115" height="115">
            <div class="main_text">
                <h1 class="main_header">StraightFace</h1>  
                <p>&bull; StraightFace is a random video-chat roulette app with a twist... one of you will try and make the other person smile or laugh!<br><br></p>
                <p>&bull; Once the game starts, you will have 1 minute
                    to win the round.<br><br></p>
                <p>&bull; If you're team Yellow, use your creativity, humor, and 
                    charisma to make the other player laugh or smile.<br><br></p>
                <p>&bull; If you're team Grey, your goal is to 
                    resist laughing or smiling during your turn. Even a slight grin might give it away.<br><br></p>
                <p>&bull; Good Luck and Have Fun!</p>
            </div>        
            <div class="queueBtn_container">           
                <a href="/videoChat_funny" class="queue_btn" id="funnyBtn"><img class="emotionIcon" src="static/images/onlyFunnyFace.svg" alt="HappyFace">Make Someone Laugh<i class="fa-solid fa-chevron-right fa-lg" style="color: #0F0F0F;"></i></a>
                <a href="/videoChat_serious" class="queue_btn" id="seriousBtn"><img class="emotionIcon" src="static/images/onlyStraightFace.svg" alt="SeriousFace">Keep a Straight Face<i class="fa-solid fa-chevron-right fa-lg" style="color: #0F0F0F;"></i></a>
            </div>            
        </div>

        <div id="friends_container">
            <i id="friends_logo" class="fa-solid fa-user-group fa-2xl" style="color: #ffffff;" width="100" height="100"></i>
            <h1 id="friends_header">Friends</h1>
            <div id="friends_list"></div>
            <div id="add_friend_container">
                <input type="text" id="friend_input" placeholder="Enter Username">
                <button id="add_friend" onclick="addFriend()">Add Friend</button>
            </div>
        </div>
    </main>

    <footer>
    </footer> 
    
    <script>

        document.addEventListener('DOMContentLoaded', fetchFriends);

        function rotateLogo() {
            var logo = document.getElementById('logo');
            logo.style.animation = 'none';
            void logo.offsetWidth;
            logo.style.animation = null; 
        }
    
        setInterval(rotateLogo, 8000);

        function fetchFriends() {
            fetch('/friends')
                .then(response => response.json())
                .then(data => {
                    displayFriends(data);
                })
                .catch(error => console.error('Error fetching friends:', error));
        }

        function displayFriends(friends) {
            const friends_list = document.getElementById('friends_list');

            for (let i = 0; i < friends.length; i++) {
    
                const friendDiv = document.createElement('div');
                friendDiv.classList.add('friend');
                friendDiv.textContent = friends[i];

                const removeButton = document.createElement('button');
                removeButton.innerHTML = '<i class="fa-solid fa-user-minus" style="color: #ffffff;"></i>';
                removeButton.classList.add('remove_friend');
                removeButton.addEventListener('click', function() { removeFriend(friends[i]); });

                friendDiv.appendChild(removeButton);
                friends_list.appendChild(friendDiv);
            }
        }
        

        function addFriend() {
            let username = document.getElementById('friend_input').value;
            let formData = new FormData();
            formData.append('username', username);

            let request = new XMLHttpRequest();
            request.open('POST', '/addFriend');
            request.onload = function() {
                try {
                    console.log('Friend added');
                    document.getElementById('friend_input').value = '';
                    friends_list.innerHTML = '';
                    formData = new FormData();
                    fetchFriends();
                } catch (error) {
                    console.error('Error adding friend:', error);
                }
            };
            request.send(formData);
        }

        function removeFriend(friend) {
            let formData = new FormData();
            formData.append('username', friend);

            let request = new XMLHttpRequest();
            request.open('POST', '/removeFriend');
            request.onload = function() {
                try {
                    console.log('Friend Removed');
                    friends_list.innerHTML = '';
                    formData = new FormData();
                    fetchFriends();
                } catch (error) {
                    console.error('Error removing friend:', error);
                }
            };
            request.send(formData);
        }

        document.getElementById('friend_input').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                let input = document.getElementById('friend_input').value;
                if (input !== '') {
                    addFriend();
                }
            }
        });

    </script> 
        
</body>